vars:
    - API_KEY_BLOCK
    - QUERY
    - COLLECTIONS
    - START_DATE
    - END_DATE
    - NAME
    - S3_PREFIX
steps:
    #Discovery Block
    - QueryOnlineNews:
        params:
            api_key_block: $API_KEY_BLOCK
            query: $QUERY
            collections: $COLLECTIONS
            start_date: $START_DATE
            end_date: $END_DATE
        outputs:
            text: text
            title: article_title
            media_name: domain
            publish_date: pub_date
            url: url
            language: language


    #Entities Block
    - SpacyNER:
        inputs:
            text: text
        outputs:
            entities: entities
        
    #ORG Entities   
    - TopNEntities:
        params:
            top_n: 100
            sort_by: "percentage"
            filter_type: "ORG"
        inputs:
            entities: entities
        outputs:
            top_entities: top_orgs
            entity_counts: org_counts
            entity_appearance_percent: org_percent

    - CSVToS3:
        params:
            columns:
                - top_orgs
                - org_counts
                - org_percent
            credentials_block: "aws-s3-credentials"
            bucket_name: "mediacloud-sous-chef-output"
            object_name: "$S3_PREFIX/DATE/$NAME-org-entities.csv"
            object_date_slug: true

    #PER Entities
    - TopNEntities:
        params:
            top_n: 100
            sort_by: "percentage"
            filter_type: "PER"
        inputs:
            entities: entities
        outputs:
            top_entities: top_persons
            entity_counts: person_counts
            entity_appearance_percent: person_percent

    - CSVToS3:
        params:
            columns:
                - top_persons
                - person_counts
                - person_percent
            credentials_block: "aws-s3-credentials"
            bucket_name: "mediacloud-sous-chef-output"
            object_name: "$S3_PREFIX/DATE/$NAME-person-entities.csv"
            object_date_slug: true

    ##Keywords block
    - ExtractKeywords:
        inputs:
            text: text
            language: language
        outputs:
            keywords: keywords

    - TopKeywords:
        params:
            top_n: 100
            sort_by: "percentage"
        inputs: 
            keywords: keywords
        outputs:
            top_keywords: top_keywords
            keyword_counts: keyword_counts
            keyword_appearance_percent: keyword_appearance_percent

    - CSVToS3:
        params:
            columns:
                - top_keywords
                - keyword_counts
                - keyword_appearance_percent
            credentials_block: "aws-s3-credentials"
            bucket_name: "mediacloud-sous-chef-output"
            object_name: "$S3_PREFIX/DATE/$NAME-keywords.csv"
            object_date_slug: true
